<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>rxn.reaction_preprocessing.mixed_reaction_filter &mdash; RXN reaction preprocessing 0.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> RXN reaction preprocessing
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../README.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">Python API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">RXN reaction preprocessing</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>rxn.reaction_preprocessing.mixed_reaction_filter</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for rxn.reaction_preprocessing.mixed_reaction_filter</h1><div class="highlight"><pre>
<span></span><span class="c1"># LICENSED INTERNAL CODE. PROPERTY OF IBM.</span>
<span class="c1"># IBM Research Zurich Licensed Internal Code</span>
<span class="c1"># (C) Copyright IBM Corp. 2022</span>
<span class="c1"># ALL RIGHTS RESERVED</span>
<span class="sd">&quot;&quot;&quot; A class encapsulating filtering functionality for chemical reactions &quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">rxn.chemutils.exceptions</span> <span class="kn">import</span> <span class="n">InvalidSmiles</span>
<span class="kn">from</span> <span class="nn">rxn.chemutils.reaction_equation</span> <span class="kn">import</span> <span class="n">ReactionEquation</span>
<span class="kn">from</span> <span class="nn">rxn.chemutils.tokenization</span> <span class="kn">import</span> <span class="n">to_tokens</span>

<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">MolEquation</span><span class="p">,</span> <span class="n">get_atoms_for_mols</span><span class="p">,</span> <span class="n">get_formal_charge_for_mols</span>

<span class="n">POLYMER_HEAD_AND_TAIL_PLACEHOLDER_ATOMS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Kr&quot;</span><span class="p">,</span> <span class="s2">&quot;Rn&quot;</span><span class="p">,</span> <span class="s2">&quot;Xe&quot;</span><span class="p">}</span>

<span class="n">SmilesBasedCheck</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">ReactionEquation</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span>
<span class="n">MolBasedCheck</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">MolEquation</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span>


<div class="viewcode-block" id="ReactionFilterError"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.ReactionFilterError.html#rxn.reaction_preprocessing.mixed_reaction_filter.ReactionFilterError">[docs]</a><span class="k">class</span> <span class="nc">ReactionFilterError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception raised when calling validate() on reactions not passing one</span>
<span class="sd">    or several filters.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">ReactionEquation</span><span class="p">,</span> <span class="n">reasons</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="c1"># Store information just in case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reaction</span> <span class="o">=</span> <span class="n">reaction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reasons</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">reasons</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Reaction &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">reaction</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; did not pass the &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;filters: </span><span class="si">{</span><span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reasons</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="MixedReactionFilter"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter">[docs]</a><span class="k">class</span> <span class="nc">MixedReactionFilter</span><span class="p">:</span>
<div class="viewcode-block" id="MixedReactionFilter.__init__"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">max_reactants</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">max_agents</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">max_products</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">min_reactants</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">min_agents</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">min_products</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">max_reactants_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
        <span class="n">max_agents_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">max_products_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">max_absolute_formal_charge</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a new instance of the type MixedReactionFilter.</span>

<span class="sd">        Args:</span>
<span class="sd">            max_reactants: The maximum number of reactant molecules.</span>
<span class="sd">            max_agents: The maximum number of agent molcules.</span>
<span class="sd">            max_products: The maximum number of product molecules.</span>
<span class="sd">            min_reactants: The minimum number of reactant molecules.</span>
<span class="sd">            min_agents: The minium number of agent molecules.</span>
<span class="sd">            min_products: The minimum number of product molecules.</span>
<span class="sd">            max_reactants_tokens: The maximum number of precursor tokens.</span>
<span class="sd">            max_agents_tokens: The maximum number of agent tokens.</span>
<span class="sd">            max_products_tokens: The maximum number of product tokens.</span>
<span class="sd">            max_absolute_formal_charge: The maximum formal charge (for</span>
<span class="sd">                reactants, agents, or products).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_reactants</span> <span class="o">=</span> <span class="n">max_reactants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_agents</span> <span class="o">=</span> <span class="n">max_agents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_products</span> <span class="o">=</span> <span class="n">max_products</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_reactants</span> <span class="o">=</span> <span class="n">min_reactants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_agents</span> <span class="o">=</span> <span class="n">min_agents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_products</span> <span class="o">=</span> <span class="n">min_products</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_reactants_tokens</span> <span class="o">=</span> <span class="n">max_reactants_tokens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_agents_tokens</span> <span class="o">=</span> <span class="n">max_agents_tokens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_products_tokens</span> <span class="o">=</span> <span class="n">max_products_tokens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_absolute_formal_charge</span> <span class="o">=</span> <span class="n">max_absolute_formal_charge</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">smiles_based_checks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">SmilesBasedCheck</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_reactants_exceeded</span><span class="p">,</span> <span class="s2">&quot;max_reactants_exceeded&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_agents_exceeded</span><span class="p">,</span> <span class="s2">&quot;max_agents_exceeded&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_products_exceeded</span><span class="p">,</span> <span class="s2">&quot;max_products_exceeded&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_reactants_subceeded</span><span class="p">,</span> <span class="s2">&quot;min_reactants_subceeded&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_agents_subceeded</span><span class="p">,</span> <span class="s2">&quot;min_agents_subceeded&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_products_subceeded</span><span class="p">,</span> <span class="s2">&quot;min_products_subceeded&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">products_subset_of_reactants</span><span class="p">,</span> <span class="s2">&quot;products_subset_of_reactants&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_reactant_tokens_exceeded</span><span class="p">,</span> <span class="s2">&quot;max_reactant_tokens_exceeded&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_agent_tokens_exceeded</span><span class="p">,</span> <span class="s2">&quot;max_agent_tokens_exceeded&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_product_tokens_exceeded</span><span class="p">,</span> <span class="s2">&quot;max_product_tokens_exceeded&quot;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol_based_checks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">MolBasedCheck</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">products_single_atoms</span><span class="p">,</span> <span class="s2">&quot;products_single_atoms&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formal_charge_exceeded</span><span class="p">,</span> <span class="s2">&quot;formal_charge_exceeded&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invalid_atom_type</span><span class="p">,</span> <span class="s2">&quot;invalid_atom_type&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">different_atom_types</span><span class="p">,</span> <span class="s2">&quot;different_atom_types&quot;</span><span class="p">),</span>
        <span class="p">]</span></div>

<div class="viewcode-block" id="MixedReactionFilter.validate"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">ReactionEquation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make sure that the given reaction is valid; if not, an exception will</span>
<span class="sd">        be raised.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ReactionFilterError: if the reaction does not pass the filters.</span>

<span class="sd">        Args:</span>
<span class="sd">            reaction: reaction to validate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid</span><span class="p">,</span> <span class="n">reasons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_reasons</span><span class="p">(</span><span class="n">reaction</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ReactionFilterError</span><span class="p">(</span><span class="n">reaction</span><span class="p">,</span> <span class="n">reasons</span><span class="p">)</span></div>

<div class="viewcode-block" id="MixedReactionFilter.is_valid"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.is_valid">[docs]</a>    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">ReactionEquation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether a reaction is valid based on the rules set on the instance of this</span>
<span class="sd">        MixedReactionFilter class.</span>

<span class="sd">        Args:</span>
<span class="sd">            reaction: The reaction to validate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether or not the reaction is valid according to the rules</span>
<span class="sd">            set on the instance of this MixedReactionFilter class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">callbacks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[],</span> <span class="nb">bool</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="sd">&quot;&quot;&quot;Generator function for providing the checks to make as</span>
<span class="sd">            callable objects.</span>

<span class="sd">            Formulating it as a generator makes it efficient; for instance,</span>
<span class="sd">            the mol_equation object will not be generated if any of the</span>
<span class="sd">            SMILES-based checks fails.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">smiles_based_fn</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">smiles_based_checks</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">partial</span><span class="p">(</span><span class="n">smiles_based_fn</span><span class="p">,</span> <span class="n">reaction</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">mol_equation</span> <span class="o">=</span> <span class="n">MolEquation</span><span class="o">.</span><span class="n">from_reaction_equation</span><span class="p">(</span><span class="n">reaction</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">InvalidSmiles</span><span class="p">:</span>
                <span class="c1"># If there is an invalid SMILES, we yield a final callback that</span>
                <span class="c1"># will then return `True` (meaning: invalid)</span>
                <span class="k">yield</span> <span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span>
                <span class="k">return</span>

            <span class="k">for</span> <span class="n">mol_based_fn</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol_based_checks</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">partial</span><span class="p">(</span><span class="n">mol_based_fn</span><span class="p">,</span> <span class="n">mol_equation</span><span class="p">)</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">callback</span><span class="p">()</span> <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="n">callbacks</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="nf">validate_reasons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">ReactionEquation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="n">reasons</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">smiles_based_fn</span><span class="p">,</span> <span class="n">error_message</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">smiles_based_checks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">smiles_based_fn</span><span class="p">(</span><span class="n">reaction</span><span class="p">):</span>
                <span class="n">reasons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">mol_equation</span> <span class="o">=</span> <span class="n">MolEquation</span><span class="o">.</span><span class="n">from_reaction_equation</span><span class="p">(</span><span class="n">reaction</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">InvalidSmiles</span><span class="p">:</span>
            <span class="n">reasons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;rdkit_molfromsmiles_failed&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">mol_based_fn</span><span class="p">,</span> <span class="n">error_message</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol_based_checks</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mol_based_fn</span><span class="p">(</span><span class="n">mol_equation</span><span class="p">):</span>
                    <span class="n">reasons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reasons</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">valid</span><span class="p">,</span> <span class="n">reasons</span>

<div class="viewcode-block" id="MixedReactionFilter.max_reactants_exceeded"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.max_reactants_exceeded">[docs]</a>    <span class="k">def</span> <span class="nf">max_reactants_exceeded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">ReactionEquation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Checks whether the number of reactants exceeds the maximum.</span>

<span class="sd">        Args:</span>
<span class="sd">            reaction: The reaction to test.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the number of reactants exceeds the maximum.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">reactants</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_reactants</span></div>

<div class="viewcode-block" id="MixedReactionFilter.max_agents_exceeded"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.max_agents_exceeded">[docs]</a>    <span class="k">def</span> <span class="nf">max_agents_exceeded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">ReactionEquation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Checks whether the number of agents exceeds the maximum.</span>

<span class="sd">        Args:</span>
<span class="sd">            reaction: The reaction to test.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the number of agents exceeds the maximum.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_agents</span></div>

<div class="viewcode-block" id="MixedReactionFilter.max_products_exceeded"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.max_products_exceeded">[docs]</a>    <span class="k">def</span> <span class="nf">max_products_exceeded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">ReactionEquation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Checks whether the number of products exceeds the maximum.</span>

<span class="sd">        Args:</span>
<span class="sd">            reaction: The reaction to test.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the number of products exceeds the maximum.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">products</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_products</span></div>

<div class="viewcode-block" id="MixedReactionFilter.min_reactants_subceeded"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.min_reactants_subceeded">[docs]</a>    <span class="k">def</span> <span class="nf">min_reactants_subceeded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">ReactionEquation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Checks whether the number of reactants exceeds the maximum.</span>

<span class="sd">        Args:</span>
<span class="sd">            reaction: The reaction to test.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the number of reactants exceeds the maximum.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">reactants</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_reactants</span></div>

<div class="viewcode-block" id="MixedReactionFilter.min_agents_subceeded"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.min_agents_subceeded">[docs]</a>    <span class="k">def</span> <span class="nf">min_agents_subceeded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">ReactionEquation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Checks whether the number of agents exceeds the maximum.</span>

<span class="sd">        Args:</span>
<span class="sd">            reaction: The reaction to test.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the number of agents exceeds the maximum.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_agents</span></div>

<div class="viewcode-block" id="MixedReactionFilter.min_products_subceeded"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.min_products_subceeded">[docs]</a>    <span class="k">def</span> <span class="nf">min_products_subceeded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">ReactionEquation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Checks whether the number of products exceeds the maximum.</span>

<span class="sd">        Args:</span>
<span class="sd">            reaction: The reaction to test.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the number of products exceeds the maximum.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">products</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_products</span></div>

<div class="viewcode-block" id="MixedReactionFilter.products_subset_of_reactants"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.products_subset_of_reactants">[docs]</a>    <span class="k">def</span> <span class="nf">products_subset_of_reactants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">ReactionEquation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Checks whether the set of products is a subset of the set of reactants.</span>

<span class="sd">        Args:</span>
<span class="sd">            reaction: The reaction to test.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the set of products is a subset of the set of reactants.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">products</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">products</span><span class="p">)</span>
        <span class="n">reactants</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">reactants</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">products</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">products</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">reactants</span><span class="p">)</span></div>

<div class="viewcode-block" id="MixedReactionFilter.products_single_atoms"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.products_single_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">products_single_atoms</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">MolEquation</span><span class="p">,</span> <span class="n">ReactionEquation</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Checks whether the products solely consist of single atoms.</span>

<span class="sd">        Args:</span>
<span class="sd">            reaction: The reaction to test.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the products solely consist of single atoms.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reaction</span><span class="p">,</span> <span class="n">ReactionEquation</span><span class="p">):</span>
            <span class="n">reaction</span> <span class="o">=</span> <span class="n">MolEquation</span><span class="o">.</span><span class="n">from_reaction_equation</span><span class="p">(</span><span class="n">reaction</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">products</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span><span class="n">product</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">reaction</span><span class="o">.</span><span class="n">products</span><span class="p">]</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MixedReactionFilter.max_reactant_tokens_exceeded"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.max_reactant_tokens_exceeded">[docs]</a>    <span class="k">def</span> <span class="nf">max_reactant_tokens_exceeded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">ReactionEquation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check whether the number of reactant tokens exceeds the maximum.</span>

<span class="sd">        Args:</span>
<span class="sd">            reaction: The reaction to test.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [type]: Whether the number of reactant tokens exceeds the maximum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_tokens_exceeded</span><span class="p">(</span>
            <span class="n">reaction</span><span class="o">.</span><span class="n">reactants</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_reactants_tokens</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MixedReactionFilter.max_agent_tokens_exceeded"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.max_agent_tokens_exceeded">[docs]</a>    <span class="k">def</span> <span class="nf">max_agent_tokens_exceeded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">ReactionEquation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check whether the number of agent tokens exceeds the maximum.</span>

<span class="sd">        Args:</span>
<span class="sd">            reaction: The reaction to test.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [type]: Whether the number of agent tokens exceeds the maximum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_tokens_exceeded</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">agents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_agents_tokens</span><span class="p">)</span></div>

<div class="viewcode-block" id="MixedReactionFilter.max_product_tokens_exceeded"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.max_product_tokens_exceeded">[docs]</a>    <span class="k">def</span> <span class="nf">max_product_tokens_exceeded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">ReactionEquation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check whether the number of product tokens exceeds the maximum.</span>

<span class="sd">        Args:</span>
<span class="sd">            reaction: The reaction to test.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [type]: Whether the number of product tokens exceeds the maximum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_tokens_exceeded</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">products</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_products_tokens</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_group_tokens_exceeded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">smiles_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check whether the number of SMILES tokens in a group exceeds the maximum.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [type]: Whether the number of product tokens exceeds the maximum.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">smiles</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">smiles_list</span>
        <span class="p">)</span>  <span class="c1"># NB: we use &#39;.&#39; here, but &#39;~&#39; would be the same.</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_tokens</span><span class="p">(</span><span class="n">smiles</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">threshold</span>

<div class="viewcode-block" id="MixedReactionFilter.formal_charge_exceeded"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.formal_charge_exceeded">[docs]</a>    <span class="k">def</span> <span class="nf">formal_charge_exceeded</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">MolEquation</span><span class="p">,</span> <span class="n">ReactionEquation</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check whether the absolute formal charge of the reactants, agents,</span>
<span class="sd">        or products exceeds a maximum.</span>

<span class="sd">        Args:</span>
<span class="sd">            reaction: The reaction to test.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the absolute formal charge of the reactants, agents,</span>
<span class="sd">            or products exceeds a maximum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reaction</span><span class="p">,</span> <span class="n">ReactionEquation</span><span class="p">):</span>
            <span class="n">reaction</span> <span class="o">=</span> <span class="n">MolEquation</span><span class="o">.</span><span class="n">from_reaction_equation</span><span class="p">(</span><span class="n">reaction</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">abs</span><span class="p">(</span><span class="n">get_formal_charge_for_mols</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">reactants</span><span class="p">))</span>
            <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_absolute_formal_charge</span>
            <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">get_formal_charge_for_mols</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">agents</span><span class="p">))</span>
            <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_absolute_formal_charge</span>
            <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">get_formal_charge_for_mols</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">products</span><span class="p">))</span>
            <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_absolute_formal_charge</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MixedReactionFilter.invalid_atom_type"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.invalid_atom_type">[docs]</a>    <span class="k">def</span> <span class="nf">invalid_atom_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">MolEquation</span><span class="p">,</span> <span class="n">ReactionEquation</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether the reaction contains atoms with invalid atom types such as the asterisk &quot;*&quot;.</span>

<span class="sd">        Args:</span>
<span class="sd">            reaction: The reaction to test.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the reaction contains invalid atom types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reaction</span><span class="p">,</span> <span class="n">ReactionEquation</span><span class="p">):</span>
            <span class="n">reaction</span> <span class="o">=</span> <span class="n">MolEquation</span><span class="o">.</span><span class="n">from_reaction_equation</span><span class="p">(</span><span class="n">reaction</span><span class="p">)</span>

        <span class="c1"># So far, the only invalid atom type is &quot;*&quot;; this function can be</span>
        <span class="c1"># reformulated to account for additional ones if some appear later on.</span>
        <span class="n">mols</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">reactants</span><span class="p">,</span> <span class="n">reaction</span><span class="o">.</span><span class="n">agents</span><span class="p">,</span> <span class="n">reaction</span><span class="o">.</span><span class="n">products</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">get_atoms_for_mols</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span></div>

<div class="viewcode-block" id="MixedReactionFilter.different_atom_types"><a class="viewcode-back" href="../../../generated/rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.html#rxn.reaction_preprocessing.mixed_reaction_filter.MixedReactionFilter.different_atom_types">[docs]</a>    <span class="k">def</span> <span class="nf">different_atom_types</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">MolEquation</span><span class="p">,</span> <span class="n">ReactionEquation</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check whether the products contain atom types not found in the agents or reactants.</span>

<span class="sd">        It handles the presence of placeholders for polymer head and tail representations.</span>

<span class="sd">        Args:</span>
<span class="sd">            reaction: The reaction to test.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the products contain atom types not found in the agents or reactants.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reaction</span><span class="p">,</span> <span class="n">ReactionEquation</span><span class="p">):</span>
            <span class="n">reaction</span> <span class="o">=</span> <span class="n">MolEquation</span><span class="o">.</span><span class="n">from_reaction_equation</span><span class="p">(</span><span class="n">reaction</span><span class="p">)</span>

        <span class="n">products_atoms</span> <span class="o">=</span> <span class="n">get_atoms_for_mols</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">products</span><span class="p">)</span>
        <span class="c1"># ignore atoms used in polymer representations</span>
        <span class="n">products_atoms</span> <span class="o">-=</span> <span class="n">POLYMER_HEAD_AND_TAIL_PLACEHOLDER_ATOMS</span>
        <span class="n">agents_atoms</span> <span class="o">=</span> <span class="n">get_atoms_for_mols</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span>
        <span class="n">reactants_atoms</span> <span class="o">=</span> <span class="n">get_atoms_for_mols</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">reactants</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">products_atoms</span> <span class="o">-</span> <span class="p">(</span><span class="n">reactants_atoms</span> <span class="o">|</span> <span class="n">agents_atoms</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright IBM RXN team 2022.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>