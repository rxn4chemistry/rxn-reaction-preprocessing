#!/usr/bin/env python
# LICENSED INTERNAL CODE. PROPERTY OF IBM.
# IBM Research Zurich Licensed Internal Code
# (C) Copyright IBM Corp. 2020
# ALL RIGHTS RESERVED
import os
import sys
from pathlib import Path
from typing import TextIO

import click
import pandas as pd

import rxn_reaction_preprocessing as rrp


@click.command()
@click.argument('input_file_path', type=click.Path(exists=True), required=True)
@click.argument('output_directory', type=click.Path(), required=True)
@click.option('--split-ratio', default=0.05)
def cli(input_file_path: str, output_directory: str, split_ratio: float) -> None:
    """The entry point for this cli script.

    Args:
        input (str):  The input file path.
        output_directory_path (str): The output directory (where train, validation, and test files will be written to).
    """
    df = pd.read_csv(input_file_path)

    # Split into train, validation, and test sets, but do not export yet
    train, validation, test = rrp.StableDataSplitter.split(df, 'rxn', split_ratio=split_ratio)

    # Get the file name without the extension
    stem = Path(input_file_path).stem

    # Example of exporting one of the sets
    df.rxn[train].to_csv(os.path.join(output_directory, stem + '.train.csv'))
    df.rxn[validation].to_csv(os.path.join(output_directory, stem + '.validation.csv'))
    df.rxn[test].to_csv(os.path.join(output_directory, stem + '.test.csv'))


if __name__ == '__main__':
    cli()
